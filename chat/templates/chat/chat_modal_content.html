{% load static %}

<div class="chat-modal-container h-full flex flex-col">
    <!-- Header -->
    <div class="bg-white border-b p-4 flex items-center justify-between">
        <h2 class="text-lg font-semibold">Messages</h2>
        <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Chat list -->
    <div class="flex-1 overflow-y-auto p-4 bg-gray-50">
        {% if chats %}
            <div class="space-y-3">
                {% for chat in chats %}
                    <div class="bg-white rounded-lg p-3 shadow-sm hover:shadow-md transition-shadow cursor-pointer"
                         onclick="openChat({{ chat.id }})">
                        <div class="flex items-center space-x-3">
                            {% if chat.other_user.profile_pic %}
                                <img src="{{ chat.other_user.profile_pic.url }}" 
                                     alt="{{ chat.other_user.get_full_name }}"
                                     class="w-10 h-10 rounded-full object-cover">
                            {% else %}
                                <div class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center">
                                    <i class="fas fa-user text-gray-500"></i>
                                </div>
                            {% endif %}
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <h3 class="font-medium">{{ chat.other_user.get_full_name }}</h3>
                                    {% if chat.last_message %}
                                        <span class="text-xs text-gray-500">
                                            {{ chat.last_message.timestamp|timesince }} ago
                                        </span>
                                    {% endif %}
                                </div>
                                {% if chat.last_message %}
                                    <p class="text-sm text-gray-600 truncate">
                                        {{ chat.last_message.content|truncatechars:50 }}
                                    </p>
                                {% else %}
                                    <p class="text-sm text-gray-500 italic">No messages yet</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8">
                <i class="fas fa-comments text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">No conversations yet</p>
                <p class="text-sm text-gray-400 mt-2">Start chatting with friends to see conversations here</p>
            </div>
        {% endif %}
    </div>

    <!-- Footer -->
    <div class="bg-white border-t p-4">
        <a href="{% url 'chat:chat_home' %}" 
           class="block w-full text-center bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
            View Full Chat
        </a>
    </div>
</div>

<script>
function openChat(chatId) {
    // Redirect to the specific chat
    window.parent.location.href = `/chat/${chatId}/`;
}
</script>
