{% load static %}
<link rel="stylesheet" href="{% static 'registerandlogin/css/register.css' %}">
{% block content %}
<div class="register-container">
  <h2>Register</h2>

  <form method="post" class="register-form">
    {% csrf_token %}

    {# Show all non-field (global) form errors #}
    {% if form.non_field_errors %}
      <div class="register-message">{{ form.non_field_errors.0 }}</div>
    {% endif %}

    <label>First Name:</label> {{ form.first_name }}
    {% if form.first_name.errors %}
      <div class="register-message">{{ form.first_name.errors.0 }}</div>
    {% endif %}

    <label>Last Name:</label> {{ form.last_name }}
    {% if form.last_name.errors %}
      <div class="register-message">{{ form.last_name.errors.0 }}</div>
    {% endif %}

    <label>Email:</label> {{ form.email }}
    {% if form.email.errors %}
      <div class="register-message">{{ form.email.errors.0 }}</div>
    {% endif %}

    <label>Date of Birth:</label> {{ form.date_of_birth }}
    {% if form.date_of_birth.errors %}
      <div class="register-message">{{ form.date_of_birth.errors.0 }}</div>
    {% endif %}

    <label>Gender:</label> {{ form.gender }}
    {% if form.gender.errors %}
      <div class="register-message">{{ form.gender.errors.0 }}</div>
    {% endif %}

    <div id="pronouns-wrapper" style="display: none;">
      <label>Preferred Pronouns:</label> {{ form.pronouns }}
      {% if form.pronouns.errors %}
        <div class="register-message">{{ form.pronouns.errors.0 }}</div>
      {% endif %}
    </div>
    
    <div id="custom-pronouns-wrapper" style="display: none;">
      <label>Your Custom Pronouns:</label> {{ form.custom_pronouns }}
      {% if form.custom_pronouns.errors %}
        <div class="register-message">{{ form.custom_pronouns.errors.0 }}</div>
      {% endif %}
    </div>

    <label>Phone Number:</label> {{ form.phone_number }}<br>
    <small style="color:gray;">Include country code (e.g. +32 for Belgium, +1 for USA)</small><br>
    {% if form.phone_number.errors %}
        <div style="color:red;">{{ form.phone_number.errors.0 }}</div>
    {% endif %}

    <label>Password:</label> {{ form.password }}
    {% if form.password.errors %}
      <div class="register-message">{{ form.password.errors.0 }}</div>
    {% endif %}

    <label>Confirm Password:</label> {{ form.confirm_password }}
    {% if form.confirm_password.errors %}
      <div class="register-message">{{ form.confirm_password.errors.0 }}</div>
    {% endif %}

    <label>{{ form.captcha.label }}</label> {{ form.captcha }}
    {% if form.captcha.errors %}
      <div class="register-message">{{ form.captcha.errors.0 }}</div>
    {% endif %}

    <button type="submit">Register</button>
  </form>
  <a class="register-link" href="{% url 'login' %}">Already have an account? Log in</a>
</div>

<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const genderSelect = document.querySelector('select[name="gender"]');
        const pronounsSelect = document.querySelector('select[name="pronouns"]');
        const customInput = document.getElementById('custom-pronouns-wrapper');
        const pronounsWrapper = document.getElementById('pronouns-wrapper');

        function togglePronouns() {
            const gender = genderSelect.value;
            const pronouns = pronounsSelect.value;

            if (gender === 'other') {
                pronounsWrapper.style.display = 'block';
            } else {
                pronounsWrapper.style.display = 'none';
                customInput.style.display = 'none';
            }

            if (pronouns === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        genderSelect.addEventListener('change', togglePronouns);
        pronounsSelect.addEventListener('change', togglePronouns);
        togglePronouns();  // Initial state
    });
</script>
{% endblock %}
