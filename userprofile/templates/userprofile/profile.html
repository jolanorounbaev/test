{% extends 'base.html' %}

{% block title %}Profile{% endblock %}
{% block content %}
{% load static %}
{% load custom_filters %} 
<link rel="stylesheet" href="{% static 'userprofile/css/profile.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<script src="{% static 'userprofile/js/profile.js' %}" defer></script></script>


<div class="profile-container">
  <!-- Main Profile Card -->
  <div class="profile-main-card">
    <div class="profile-header-section">
      <div class="profile-avatar-container">
        {% if profile_user.profile_picture %}
          <img src="{{ profile_user.profile_picture.url }}" alt="Profile Picture" class="profile-avatar">
        {% else %}
          <div class="profile-avatar-placeholder">
            <i class="fas fa-user"></i>
          </div>
        {% endif %}
      </div>
      
      <div class="profile-main-info">
        <h1 class="profile-name">{{ profile_user.full_name }}</h1>
        
        <div class="profile-details">
          {% if profile_user.show_date_of_birth %}
            <div class="profile-detail-item">
              <i class="fas fa-birthday-cake"></i>
              <span>Age: {{ profile_user.get_age }}</span>
            </div>
          {% endif %}
          
          {% if profile_user.gender != 'other' and profile_user.show_gender %}
            <div class="profile-detail-item">
              <i class="fas fa-user-tag"></i>
              <span>Gender: {{ profile_user.gender }}</span>
            </div>
          {% endif %}
          
          <div class="profile-detail-item">
            <i class="fas fa-language"></i>
            <span>{{ profile_user.main_language_flag }} {{ profile_user.get_main_language_display }}</span>
          </div>
          
          <div class="profile-detail-item">
            <i class="fas fa-comment"></i>
            <span>{{ profile_user.sublanguage_flag }} {{ profile_user.get_sublanguage_display }}</span>
          </div>
        </div>
        
        {% if profile_user.show_bio and profile_user.bio %}
          <div class="profile-bio">
            <h3><i class="fas fa-info-circle"></i> About Me</h3>
            <p>{{ profile_user.bio }}</p>
          </div>
        {% endif %}
      </div>
      
      <div class="profile-actions">
        {% if is_own_profile %}
          <button class="btn btn-primary" id="openEditProfileModal">
            <i class="fas fa-edit"></i> Edit Profile
          </button>
        {% else %}
          {% if not is_blocked_by_viewer %}
            <a href="/chat/{{ chat_room_id }}/" class="btn btn-primary">
              <i class="fas fa-comments"></i> Chat
            </a>
            {% if is_friend %}
              <button class="btn btn-success" disabled>
                <i class="fas fa-check"></i> Friends
              </button>
            {% elif pending_request %}
              <button class="btn btn-warning" disabled>
                <i class="fas fa-clock"></i> Request Sent
              </button>
            {% else %}
              <button class="btn btn-success" id="addFriendButton" data-user-id="{{ profile_user.id }}">
                <i class="fas fa-user-plus"></i> Add Friend
              </button>
            {% endif %}
          {% else %}
            <div class="blocked-notice">
              <i class="fas fa-ban"></i> You have blocked this user
            </div>
          {% endif %}
          
          <!-- Three dots menu -->
          <div class="profile-menu">
            <button class="btn btn-secondary menu-trigger" id="threeDots">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="dropdown-menu" id="dropdownMenu">
              {% if not is_blocked_by_viewer %}
                <button class="dropdown-item" id="reportUser" data-user-id="{{ profile_user.id }}">
                  <i class="fas fa-flag"></i> Report
                </button>
                <button class="dropdown-item" id="blockUser" data-user-id="{{ profile_user.id }}">
                  <i class="fas fa-ban"></i> Block Account
                </button>
              {% else %}
                <button class="dropdown-item" onclick="unblockUser({{ profile_user.id }}, this)">
                  <i class="fas fa-check"></i> Unblock User
                </button>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>  </div>

  <!-- Content Grid -->
  <div class="profile-content-grid">
    <!-- Interests Card -->
    <div class="content-card interests-card">
      <div class="card-header">
        <h2>
          <i class="fas fa-heart"></i>
          {% if is_own_profile %}
            My 3 Main Interests
          {% else %}
            {{ profile_user.full_name|default:profile_user.username }}'s Interests
          {% endif %}
        </h2>
      </div>
      <div class="card-content">
        <div class="interests-grid">
          {% for interest in profile_user.interests %}
            {% if interest %}
              {% with profile_user.interest_descriptions|get_item:interest as data %}
                <div class="interest-item">
                  <div class="interest-icon">
                    <i class="fas fa-star"></i>
                  </div>
                  <span class="interest-name">{{ interest }}</span>
                </div>
              {% endwith %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Places Visited Card -->
    {% if visited_places %}
    <div class="content-card places-card">
      <div class="card-header">
        <h2><i class="fas fa-map-marker-alt"></i> Places I've Visited</h2>
      </div>
      <div class="card-content">
        <div class="places-grid">
          {% for place in visited_places %}
            <div class="place-item">
              {% if place.image %}
                <img src="{{ place.image.url }}" alt="{{ place.name }}" class="place-image">
              {% else %}
                <div class="place-placeholder">
                  <i class="fas fa-image"></i>
                </div>
              {% endif %}
              <span class="place-name">{{ place.name }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Achievements and Quotes Row -->
    <div class="profile-extras-row">
      {% if achievements %}
      <div class="content-card achievements-card">
        <div class="card-header">
          <h2><i class="fas fa-trophy"></i> Achievements</h2>
        </div>
        <div class="card-content">
          <div class="achievements-grid">
            {% for achievement in achievements %}
              <div class="achievement-item">
                {% if achievement.icon %}
                  <img src="{{ achievement.icon.url }}" alt="{{ achievement.title }}" class="achievement-icon">
                {% else %}
                  <div class="achievement-placeholder">
                    <i class="fas fa-award"></i>
                  </div>
                {% endif %}
                <span class="achievement-title">{{ achievement.title }}</span>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      {% if quotes %}
      <div class="content-card quotes-card">
        <div class="card-header">
          <h2><i class="fas fa-quote-left"></i> Quotes I Live By</h2>
        </div>
        <div class="card-content">
          <div class="quotes-container">
            {% for quote in quotes %}
              <blockquote class="quote-item">
                <i class="fas fa-quote-left quote-icon"></i>
                {{ quote.text }}
              </blockquote>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Content Items Card -->
    {% if profile_user.content_items.all %}
    <div class="content-card showcase-card">
      <div class="card-header">
        <h2><i class="fas fa-star"></i> Content I Would Like to Show</h2>
        <div class="carousel-controls">
          <button class="carousel-btn prev-btn" onclick="changeSlide(-1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="carousel-btn next-btn" onclick="changeSlide(1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      <div class="card-content">
        <div class="content-carousel">
          <div class="carousel-track" id="carousel">
            {% for item in profile_user.content_items.all %}
              <div class="content-item">
                <div class="content-media">
                  {% if item.image %}
                    <img src="{{ item.image.url }}" alt="{{ item.title }}" class="content-image">
                  {% elif item.get_youtube_embed_url %}
                    <iframe src="{{ item.get_youtube_embed_url }}" 
                            class="content-video" 
                            allowfullscreen></iframe>
                  {% else %}
                    <div class="content-placeholder">
                      <i class="fas fa-file"></i>
                    </div>
                  {% endif %}
                </div>
                <div class="content-info">
                  <h3 class="content-title">{{ item.title }}</h3>
                  <p class="content-description">{{ item.description }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeEditProfileModal">&times;</span>
    <iframe src="{% url 'edit_profile' %}" frameborder="0" style="width:100%;height:90vh;min-height:600px;background:transparent;"></iframe>
  </div>
</div>

<script>
// Modal open/close logic
const modal = document.getElementById('editProfileModal');
const btn = document.getElementById('openEditProfileModal');
const span = document.getElementById('closeEditProfileModal');

// Only add event listeners if elements exist
if (btn && modal) {
  btn.onclick = function() { modal.style.display = 'block'; }
}
if (span && modal) {
  span.onclick = function() { modal.style.display = 'none'; }
}
if (modal) {
  window.onclick = function(event) { if (event.target == modal) { modal.style.display = 'none'; } }
}

function showProfileSuccessMessage() {
  // Check if jQuery is available
  if (typeof $ !== 'undefined' && $('#profile-success-msg').length === 0) {
    $('body').append('<div id="profile-success-msg" style="position:fixed;top:32px;left:50%;transform:translateX(-50%);background:#4fd18b;color:#fff;padding:18px 32px;border-radius:8px;z-index:2000;font-size:1.2em;box-shadow:0 2px 12px rgba(0,0,0,0.12);">Profile updated successfully!</div>');
    setTimeout(function() { $('#profile-success-msg').fadeOut(400, function() { $(this).remove(); }); }, 2500);
  }
}
window.showProfileSuccessMessage = showProfileSuccessMessage;

function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

// Add Friend button functionality
document.addEventListener('DOMContentLoaded', function() {
  const addFriendButton = document.getElementById('addFriendButton');
  
  if (addFriendButton) {
    addFriendButton.addEventListener('click', function(e) {
      e.preventDefault();
      
      const userId = this.getAttribute('data-user-id');
      const csrfToken = getCookie('csrftoken');
      
      if (!csrfToken) {
        alert('CSRF token not found. Please refresh the page.');
        return;
      }
      
      // Disable button to prevent double-clicking
      this.disabled = true;
      this.textContent = 'Sending...';
      
      fetch('/friendsearch/send-friend-request/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': csrfToken,
          'Content-Type': 'application/x-www-form-urlencoded',
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: new URLSearchParams({
          'user_id': userId
        }),
        credentials: 'same-origin'
      })
      .then(response => response.text())      .then(text => {
        try {
          const data = JSON.parse(text);
            if (data.success) {
            this.innerHTML = '<i class="fas fa-check"></i> Request Sent';
            this.style.background = '#28a745';
            this.style.color = 'white';
          } else {
            // Re-enable button on failure
            this.disabled = false;
            this.innerHTML = '<i class="fas fa-user-plus"></i> Add Friend';
            this.style.background = '';
            this.style.color = '';
            alert('Error: ' + data.message);
          }
        } catch (e) {
          // Re-enable button on error
          this.disabled = false;
          this.innerHTML = '<i class="fas fa-user-plus"></i> Add Friend';
          this.style.background = '';
          this.style.color = '';
          alert('Server error occurred. Please try again.');
        }
      })
      .catch(error => {
        // Re-enable button on error
        this.disabled = false;
        this.innerHTML = '<i class="fas fa-user-plus"></i> Add Friend';
        this.style.background = '';
        this.style.color = '';
        alert('Failed to send friend request. Please try again.');
      });
    });  }
});

// Three dots dropdown menu functionality
document.addEventListener('DOMContentLoaded', function() {
  const threeDotsBtn = document.getElementById('threeDots');
  const dropdownMenu = document.getElementById('dropdownMenu');
  const reportBtn = document.getElementById('reportUser');
  const blockBtn = document.getElementById('blockUser');

  if (threeDotsBtn && dropdownMenu) {
    // Toggle dropdown when clicking three dots
    threeDotsBtn.addEventListener('click', function(e) {
      e.stopPropagation();
      dropdownMenu.classList.toggle('show');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', function() {
      dropdownMenu.classList.remove('show');
    });

    // Prevent dropdown from closing when clicking inside it
    dropdownMenu.addEventListener('click', function(e) {
      e.stopPropagation();
    });
  }
  <!-- Report user functionality (placeholder) -->
  if (reportBtn) {
    reportBtn.addEventListener('click', function() {
      const userId = this.getAttribute('data-user-id');
      // Show report modal
      document.getElementById('reportModal').style.display = 'block';
      document.getElementById('reportUserId').value = userId;
      dropdownMenu.classList.remove('show');
    });
  }
  // Block user functionality
  if (blockBtn) {
    blockBtn.addEventListener('click', function() {
      const userId = this.getAttribute('data-user-id');
      if (confirm('Are you sure you want to block this user? This will prevent them from contacting you and remove any friend connections.')) {
        // Show loading state
        const originalText = this.innerHTML;
        this.innerHTML = '⏳ Blocking...';
        this.disabled = true;
        
        // Make AJAX request to block user
        fetch('/block-user/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
          },
          body: new URLSearchParams({
            'user_id': userId,
            'action': 'block'
          })
        })
        .then(response => response.json())        .then(data => {
          if (data.success) {
            // Reload the page to show the blocked state
            window.location.reload();
          } else {
            alert('Error: ' + data.message);
            this.innerHTML = originalText;
            this.disabled = false;
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred while blocking the user.');
          this.innerHTML = originalText;
          this.disabled = false;
        });
      }      dropdownMenu.classList.remove('show');
    });
  }
});

// Function to unblock a user
function unblockUser(userId, button) {
  if (confirm('Are you sure you want to unblock this user?')) {
    // Show loading state
    const originalText = button.innerHTML;
    button.innerHTML = '⏳ Unblocking...';
    button.disabled = true;
    
    // Make AJAX request to unblock user
    fetch('/block-user/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/x-www-form-urlencoded',
        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
      },
      body: new URLSearchParams({
        'user_id': userId,
        'action': 'unblock'
      })
    })
    .then(response => response.json())    .then(data => {
      if (data.success) {
        // Reload the page to update the UI
        window.location.reload();
      } else {
        alert('Error: ' + data.message);
        button.innerHTML = originalText;
        button.disabled = false;
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('An error occurred while unblocking the user.');
      button.innerHTML = originalText;
      button.disabled = false;
    });
  }
}

// Carousel functionality for content items
let currentSlide = 0;

function changeSlide(direction) {
  const carousel = document.getElementById('carousel');
  if (!carousel) return;
  
  const contentItems = carousel.querySelectorAll('.content-item');
  const totalSlides = contentItems.length;
  
  if (totalSlides === 0) return;
  
  currentSlide += direction;
  
  if (currentSlide < 0) {
    currentSlide = totalSlides - 1;
  } else if (currentSlide >= totalSlides) {
    currentSlide = 0;
  }
  
  const translateX = -currentSlide * 100;
  carousel.style.transform = `translateX(${translateX}%)`;
}

// Initialize carousel
document.addEventListener('DOMContentLoaded', function() {
  const carousel = document.getElementById('carousel');
  if (carousel) {
    // Auto-advance carousel every 5 seconds
    setInterval(() => {
      changeSlide(1);
    }, 5000);
  }
});
</script>

<style>
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100vh;
  overflow: auto;
  background-color: rgba(0,0,0,0.4);
}
.modal-content {
  background-color: #fff;
  margin: 4vh auto;
  padding: 0;
  border-radius: 18px;
  width: 90vw;
  max-width: 900px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.18);
  position: relative;
}
.close {
  color: #aaa;
  position: absolute;
  right: 24px;
  top: 18px;
  font-size: 32px;
  font-weight: bold;
  cursor: pointer;
  z-index: 10;
}
.close:hover, .close:focus { color: #ef7741; text-decoration: none; cursor: pointer; }
.modal iframe {
  border: none;
  border-radius: 0 0 18px 18px;
  width: 100%;
  min-height: 600px;
  background: transparent;
}

.profile-action-buttons {
  display: flex;
  flex-direction: column;
  gap: 10px;
  align-items: flex-end;
}

.chat-btn {
  background: #007bff;
  color: white !important;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
  min-width: 120px;
  text-decoration: none !important;
  display: inline-block;
  text-align: center;
}

.chat-btn:hover {
  background: #0056b3;
  color: white !important;
}

.add-friend-btn {
  background: #28a745;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease;
  min-width: 120px;
}

.add-friend-btn:hover {
  background: #218838;
}

.add-friend-btn:disabled {
  background: #6c757d;
  cursor: not-allowed;
}

/* Three dots dropdown menu */
.dropdown-menu-container {
  position: relative;
  display: inline-block;
}

.three-dots-btn {
  background: var(--highlight-bg);
  color: var(--text-main);
  border: 2px solid var(--accent-bg);
  padding: 12px 16px;
  border-radius: 12px;
  cursor: pointer;
  font-size: 20px;
  font-weight: bold;
  transition: all 0.3s ease;
  min-width: 50px;
  text-align: center;
}

.three-dots-btn:hover {
  background: var(--accent-bg);
  transform: translateY(-2px);
}

.dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  right: 0;
  background: var(--card-bg);
  border: 1px solid var(--accent-bg);
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  min-width: 150px;
  margin-top: 5px;
}

.dropdown-menu.show {
  display: block;
}

.dropdown-item {
  display: block;
  width: 100%;
  padding: 12px 16px;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  color: var(--text-main);
  font-size: 14px;
  transition: background 0.2s ease;
}

.dropdown-item:hover {
  background: var(--highlight-bg);
}

.dropdown-item:first-child {
  border-radius: 8px 8px 0 0;
}

.dropdown-item:last-child {
  border-radius: 0 0 8px 8px;
}

/* Report Modal Styles */
#reportModal .modal-content {
  max-width: 500px;
  margin: 10% auto;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 20px 0 20px;
}

.modal-header h2 {
  margin: 0;
  color: var(--text-main);
}

.close {
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  color: var(--text-main);
}

.close:hover {
  color: #ff4444;
}

.form-group {
  margin-bottom: 20px;
  padding: 0 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: bold;
  color: var(--text-main);
}

.form-group select,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 2px solid var(--accent-bg);
  border-radius: 8px;
  background: var(--card-bg);
  color: var(--text-main);
  font-size: 14px;
  box-sizing: border-box;
}

.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--button-color);
}

.form-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  padding: 20px;
  border-top: 1px solid var(--accent-bg);
}

.btn-cancel {
  background: var(--accent-bg);
  color: var(--text-main);
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

.btn-cancel:hover {
  background: var(--highlight-bg);
}

.btn-submit {
  background: #dc3545;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
}

.btn-submit:hover {
  background: #c82333;
}

.btn-submit:disabled {
  background: #6c757d;
  cursor: not-allowed;
}

/* Modern Profile Styles */
:root {
  --primary-color: #4f46e5;
  --secondary-color: #06b6d4;
  --success-color: #10b981;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;
  --text-primary: #1f2937;
  --text-secondary: #6b7280;
  --bg-primary: #ffffff;
  --bg-secondary: #f8fafc;
  --border-color: #e5e7eb;
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
}

.profile-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.profile-main-card {
  background: var(--bg-primary);
  border-radius: 24px;
  padding: 2.5rem;
  margin-bottom: 2rem;
  box-shadow: var(--shadow-xl);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.profile-header-section {
  display: grid;
  grid-template-columns: auto 1fr auto;
  gap: 2rem;
  align-items: start;
}

.profile-avatar-container {
  display: flex;
  justify-content: center;
  align-items: center;
}

.profile-avatar {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid var(--primary-color);
  box-shadow: var(--shadow-lg);
  transition: transform 0.3s ease;
}

.profile-avatar:hover {
  transform: scale(1.05);
}

.profile-avatar-placeholder {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  color: white;
  box-shadow: var(--shadow-lg);
}

.profile-main-info {
  flex: 1;
}

.profile-name {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0 0 1rem 0;  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.profile-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.profile-detail-item {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: var(--bg-secondary);
  border-radius: 12px;
  border-left: 4px solid var(--primary-color);
  transition: transform 0.2s ease;
}

.profile-detail-item:hover {
  transform: translateX(4px);
}

.profile-detail-item i {
  color: var(--primary-color);
  font-size: 1.1rem;
}

.profile-bio {
  background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(6, 182, 212, 0.1));
  padding: 1.5rem;
  border-radius: 16px;
  border: 1px solid rgba(79, 70, 229, 0.2);
}

.profile-bio h3 {
  color: var(--text-primary);
  margin: 0 0 0.75rem 0;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.profile-bio h3 i {
  color: var(--primary-color);
}

.profile-actions {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  align-items: flex-end;
}

.btn {
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 140px;
  justify-content: center;
  font-size: 0.95rem;
}

.btn-primary {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  box-shadow: var(--shadow-md);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
  color: white;
}

.btn-success {
  background: linear-gradient(135deg, var(--success-color), #059669);
  color: white;
  box-shadow: var(--shadow-md);
}

.btn-success:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-warning {
  background: linear-gradient(135deg, var(--warning-color), #d97706);
  color: white;
  box-shadow: var(--shadow-md);
}

.btn-secondary {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 2px solid var(--border-color);
}

.btn-secondary:hover {
  background: var(--border-color);
  transform: translateY(-2px);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none !important;
}

.blocked-notice {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
  color: var(--danger-color);
  padding: 1rem;
  border-radius: 12px;
  border: 1px solid rgba(239, 68, 68, 0.3);
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.profile-menu {
  position: relative;
}

.menu-trigger {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  min-width: unset;
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  background: var(--bg-primary);
  border: 1px solid var(--border-color);
  border-radius: 12px;
  box-shadow: var(--shadow-lg);
  min-width: 180px;
  margin-top: 0.5rem;
  overflow: hidden;
  z-index: 1000;
  display: none;
}

.dropdown-menu.show {
  display: block;
  animation: fadeInUp 0.3s ease;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dropdown-item {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  width: 100%;
  padding: 0.75rem 1rem;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  color: var(--text-primary);
  font-size: 0.9rem;
  transition: background 0.2s ease;
}

.dropdown-item:hover {
  background: var(--bg-secondary);
}

.dropdown-item i {
  width: 16px;
  text-align: center;
}

.profile-content-grid {
  display: grid;
  gap: 2rem;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
}

.content-card {
  background: var(--bg-primary);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: var(--shadow-lg);
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
  transition: transform 0.3s ease;
}

.content-card:hover {
  transform: translateY(-4px);
}

.card-header {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  padding: 1.5rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card-header h2 {
  margin: 0;
  font-size: 1.4rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card-content {
  padding: 1.5rem;
}

.interests-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
}

.interest-item {
  text-align: center;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: 12px;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.interest-item:hover {
  border-color: var(--primary-color);
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.interest-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 0.75rem;
  color: white;
  font-size: 1.2rem;
}

.interest-name {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.9rem;
}

.places-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 1rem;
}

.place-item {
  text-align: center;
  background: var(--bg-secondary);
  border-radius: 12px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.place-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.place-image {
  width: 100%;
  height: 120px;
  object-fit: cover;
}

.place-placeholder {
  width: 100%;
  height: 120px;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 2rem;
}

.place-name {
  padding: 0.75rem;
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.9rem;
}

.profile-extras-row {
  grid-column: 1 / -1;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

.achievements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  gap: 1rem;
}

.achievement-item {
  text-align: center;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: 12px;
  transition: all 0.3s ease;
}

.achievement-item:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.achievement-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  margin: 0 auto 0.5rem;
}

.achievement-placeholder {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--warning-color), #d97706);
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 0.5rem;
  color: white;
  font-size: 1.2rem;
}

.achievement-title {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.85rem;
}

.quotes-container {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.quote-item {
  position: relative;
  background: var(--bg-secondary);
  padding: 1.5rem;
  border-radius: 12px;
  margin: 0;
  border-left: 4px solid var(--primary-color);
  font-style: italic;
  color: var(--text-primary);
}

.quote-icon {
  position: absolute;
  top: -8px;
  left: 12px;
  background: var(--bg-primary);
  color: var(--primary-color);
  padding: 0.25rem;
  font-size: 0.8rem;
}

.showcase-card {
  grid-column: 1 / -1;
}

.carousel-controls {
  display: flex;
  gap: 0.5rem;
}

.carousel-btn {
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.carousel-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: scale(1.1);
}

.content-carousel {
  overflow: hidden;
  border-radius: 12px;
}

.carousel-track {
  display: flex;
  transition: transform 0.5s ease;
}

.content-item {
  flex: 0 0 100%;
  background: var(--bg-secondary);
  padding: 1.5rem;
  border-radius: 12px;
  margin-right: 1rem;
}

.content-media {
  width: 100%;
  height: 250px;
  border-radius: 8px;
  overflow: hidden;
  margin-bottom: 1rem;
}

.content-image, .content-video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border: none;
}

.content-placeholder {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 3rem;
}

.content-info {
  text-align: center;
}

.content-title {
  font-size: 1.2rem;
  font-weight: 600;
  color: var(--text-primary);
  margin: 0 0 0.75rem 0;
}

.content-description {
  color: var(--text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* Modal Improvements */
.modal {
  backdrop-filter: blur(4px);
}

.modal-content {
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.modal-header {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  color: white;
  border-radius: 18px 18px 0 0;
  margin: 0;
}

.modal-header h2 {
  color: white;
}

.close {
  color: white;
  opacity: 0.8;
}

.close:hover {
  opacity: 1;
  color: white;
}

/* Responsive Design */
@media (max-width: 768px) {
  .profile-container {
    padding: 1rem;
  }
  
  .profile-main-card {
    padding: 1.5rem;
  }
  
  .profile-header-section {
    grid-template-columns: 1fr;
    text-align: center;
    gap: 1.5rem;
  }
  
  .profile-actions {
    align-items: center;
  }
  
  .profile-content-grid {
    grid-template-columns: 1fr;
  }
  
  .profile-extras-row {
    grid-template-columns: 1fr;
  }
  
  .profile-name {
    font-size: 2rem;
  }
  
  .profile-details {
    grid-template-columns: 1fr;
  }
}
</style>

<!-- Report Modal -->
<div id="reportModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-flag"></i> Report User</h2>
      <span class="close" id="closeReportModal">&times;</span>
    </div>
    <form id="reportForm">
      {% csrf_token %}
      <input type="hidden" id="reportUserId" name="reported_user_id">
      
      <div class="form-group">
        <label for="reportReason">Reason for reporting:</label>
        <select id="reportReason" name="reason" required>
          <option value="">Select a reason</option>
          <option value="toxic_behavior">Toxic Behavior</option>
          <option value="spam">Spam</option>
          <option value="racism_homophobia">Racism or Homophobia</option>
          <option value="harassment">Harassment</option>
          <option value="inappropriate_content">Inappropriate Content</option>
          <option value="fake_profile">Fake Profile</option>
          <option value="other">Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="reportDescription">Additional details (optional):</label>
        <textarea id="reportDescription" name="description" rows="4" placeholder="Provide more details about the issue..."></textarea>
      </div>
      
      <div class="form-buttons">
        <button type="button" id="cancelReport" class="btn-cancel">Cancel</button>
        <button type="submit" class="btn-submit">Submit Report</button>
      </div>
    </form>
  </div>
</div>

<script>
// Report modal functionality
document.addEventListener('DOMContentLoaded', function() {
  const reportModal = document.getElementById('reportModal');
  const closeReportModal = document.getElementById('closeReportModal');
  const cancelReport = document.getElementById('cancelReport');
  const reportForm = document.getElementById('reportForm');

  // Close modal handlers
  if (closeReportModal) {
    closeReportModal.onclick = function() {
      reportModal.style.display = 'none';
    }
  }
  
  if (cancelReport) {
    cancelReport.onclick = function() {
      reportModal.style.display = 'none';
    }
  }

  // Handle form submission
  if (reportForm) {    reportForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const submitBtn = document.querySelector('.btn-submit');
      
      // Debug: Log form data
      console.log('Form data:');
      for (let [key, value] of formData.entries()) {
        console.log(key, value);
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';
        fetch('/report-user/', {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'X-Requested-With': 'XMLHttpRequest'
        },
        body: formData
      })
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        if (data.success) {
          reportModal.style.display = 'none';
          reportForm.reset();
          alert('Report submitted successfully. Thank you for helping keep our community safe.');
        } else {
          alert('Error: ' + data.message);
        }
      })
      .catch(error => {
        console.error('Report submission error:', error);
        alert('Failed to submit report. Error: ' + error.message);
      })
      .finally(() => {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Report';
      });
    });
  }
});
</script>

{% endblock %}
