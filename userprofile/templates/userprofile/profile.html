{% extends 'base.html' %}

{% block title %}Profile{% endblock %}
{% block content %}
{% load static %}
{% load custom_filters %} 
<link rel="stylesheet" href="{% static 'userprofile/css/profile.css' %}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<script src="{% static 'userprofile/js/profile.js' %}" defer></script></script>


<div class="profile-container">
  <!-- Main Profile Card -->
  <div class="profile-main-card">
    <div class="profile-header-section">
      <div class="profile-avatar-container">
        {% if profile_user.profile_picture %}
          <img src="{{ profile_user.profile_picture.url }}" alt="Profile Picture" class="profile-avatar">
        {% else %}
          <div class="profile-avatar-placeholder">
            <i class="fas fa-user"></i>
          </div>
        {% endif %}
      </div>
      
      <div class="profile-main-info">
        <h1 class="profile-name">{{ profile_user.full_name }}</h1>
        
        <div class="profile-details">
          {% if profile_user.show_date_of_birth %}
            <div class="profile-detail-item">
              <i class="fas fa-birthday-cake"></i>
              <span>Age: {{ profile_user.get_age }}</span>
            </div>
          {% endif %}
          
          {% if profile_user.gender != 'other' and profile_user.show_gender %}
            <div class="profile-detail-item">
              <i class="fas fa-user-tag"></i>
              <span>Gender: {{ profile_user.gender }}</span>
            </div>
          {% endif %}
          
          <div class="profile-detail-item">
            <i class="fas fa-language"></i>
            <span>{{ profile_user.main_language_flag }} {{ profile_user.get_main_language_display }}</span>
          </div>
          
          <div class="profile-detail-item">
            <i class="fas fa-comment"></i>
            <span>{{ profile_user.sublanguage_flag }} {{ profile_user.get_sublanguage_display }}</span>
          </div>
        </div>
        
        {% if profile_user.show_bio and profile_user.bio %}
          <div class="profile-bio">
            <h3><i class="fas fa-info-circle"></i> About Me</h3>
            <p>{{ profile_user.bio }}</p>
          </div>
        {% endif %}
      </div>
      
      <div class="profile-actions">
        {% if is_own_profile %}
          <button class="btn btn-primary" id="openEditProfileModal">
            <i class="fas fa-edit"></i> Edit Profile
          </button>
        {% else %}
          {% if not is_blocked_by_viewer %}
            <a href="/chat/{{ chat_room_id }}/" class="btn btn-primary">
              <i class="fas fa-comments"></i> Chat
            </a>
            {% if is_friend %}
              <button class="btn btn-success" disabled>
                <i class="fas fa-check"></i> Friends
              </button>
            {% elif pending_request %}
              <button class="btn btn-warning" disabled>
                <i class="fas fa-clock"></i> Request Sent
              </button>
            {% else %}
              <button class="btn btn-success" id="addFriendButton" data-user-id="{{ profile_user.id }}">
                <i class="fas fa-user-plus"></i> Add Friend
              </button>
            {% endif %}
          {% else %}
            <div class="blocked-notice">
              <i class="fas fa-ban"></i> You have blocked this user
            </div>
          {% endif %}
          
          <!-- Three dots menu -->
          <div class="profile-menu">
            <button class="btn btn-secondary menu-trigger" id="threeDots">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            <div class="dropdown-menu" id="dropdownMenu">
              {% if not is_blocked_by_viewer %}
                <button class="dropdown-item" id="reportUser" data-user-id="{{ profile_user.id }}">
                  <i class="fas fa-flag"></i> Report
                </button>
                <button class="dropdown-item" id="blockUser" data-user-id="{{ profile_user.id }}">
                  <i class="fas fa-ban"></i> Block Account
                </button>
              {% else %}
                <button class="dropdown-item" onclick="unblockUser({{ profile_user.id }}, this)">
                  <i class="fas fa-check"></i> Unblock User
                </button>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>  </div>

  <!-- Content Grid -->
  <div class="profile-content-grid">
    <!-- Interests Card -->
    <div class="content-card interests-card">
      <div class="card-header">
        <h2>
          <i class="fas fa-heart"></i>
          {% if is_own_profile %}
            My 3 Main Interests
          {% else %}
            {{ profile_user.full_name|default:profile_user.username }}'s Interests
          {% endif %}
        </h2>
      </div>
      <div class="card-content">
        <div class="interests-grid">
          {% for interest in profile_user.interests %}
            {% if interest %}
              {% with profile_user.interest_descriptions|get_item:interest as data %}
                <div class="interest-item">
                  <div class="interest-icon">
                    <i class="fas fa-star"></i>
                  </div>
                  <span class="interest-name">{{ interest }}</span>
                </div>
              {% endwith %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Places Visited Card -->
    {% if visited_places %}
    <div class="content-card places-card">
      <div class="card-header">
        <h2><i class="fas fa-map-marker-alt"></i> Places I've Visited</h2>
      </div>
      <div class="card-content">
        <div class="places-grid">
          {% for place in visited_places %}
            <div class="place-item">
              {% if place.image %}
                <img src="{{ place.image.url }}" alt="{{ place.name }}" class="place-image">
              {% else %}
                <div class="place-placeholder">
                  <i class="fas fa-image"></i>
                </div>
              {% endif %}
              <span class="place-name">{{ place.name }}</span>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Achievements and Quotes Row -->
    <div class="profile-extras-row">
      {% if achievements %}
      <div class="content-card achievements-card">
        <div class="card-header">
          <h2><i class="fas fa-trophy"></i> Achievements</h2>
        </div>
        <div class="card-content">
          <div class="achievements-grid">
            {% for achievement in achievements %}
              <div class="achievement-item">
                {% if achievement.icon %}
                  <img src="{{ achievement.icon.url }}" alt="{{ achievement.title }}" class="achievement-icon">
                {% else %}
                  <div class="achievement-placeholder">
                    <i class="fas fa-award"></i>
                  </div>
                {% endif %}
                <span class="achievement-title">{{ achievement.title }}</span>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      {% if quotes %}
      <div class="content-card quotes-card">
        <div class="card-header">
          <h2><i class="fas fa-quote-left"></i> Quotes I Live By</h2>
        </div>
        <div class="card-content">
          <div class="quotes-container">
            {% for quote in quotes %}
              <blockquote class="quote-item">
                <i class="fas fa-quote-left quote-icon"></i>
                {{ quote.text }}
              </blockquote>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Content Items Card -->
    {% if profile_user.content_items.all %}
    <div class="content-card showcase-card">
      <div class="card-header">
        <h2><i class="fas fa-star"></i> Content I Would Like to Show</h2>
        <div class="carousel-controls">
          <button class="carousel-btn prev-btn" onclick="changeSlide(-1)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="carousel-btn next-btn" onclick="changeSlide(1)">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      <div class="card-content">
        <div class="content-carousel">
          <div class="carousel-track" id="carousel">
            {% for item in profile_user.content_items.all %}
              <div class="content-item">
                <div class="content-media">
                  {% if item.image %}
                    <img src="{{ item.image.url }}" alt="{{ item.title }}" class="content-image">
                  {% elif item.get_youtube_embed_url %}
                    <iframe src="{{ item.get_youtube_embed_url }}" 
                            class="content-video" 
                            allowfullscreen></iframe>
                  {% else %}
                    <div class="content-placeholder">
                      <i class="fas fa-file"></i>
                    </div>
                  {% endif %}
                </div>
                <div class="content-info">
                  <h3 class="content-title">{{ item.title }}</h3>
                  <p class="content-description">{{ item.description }}</p>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeEditProfileModal">&times;</span>
    <iframe src="{% url 'edit_profile' %}" frameborder="0" style="width:100%;height:90vh;min-height:600px;background:transparent;"></iframe>
  </div>
</div>





<!-- Report Modal -->
<div id="reportModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2><i class="fas fa-flag"></i> Report User</h2>
      <span class="close" id="closeReportModal">&times;</span>
    </div>
    <form id="reportForm">
      {% csrf_token %}
      <input type="hidden" id="reportUserId" name="reported_user_id">
      
      <div class="form-group">
        <label for="reportReason">Reason for reporting:</label>
        <select id="reportReason" name="reason" required>
          <option value="">Select a reason</option>
          <option value="toxic_behavior">Toxic Behavior</option>
          <option value="spam">Spam</option>
          <option value="racism_homophobia">Racism or Homophobia</option>
          <option value="harassment">Harassment</option>
          <option value="inappropriate_content">Inappropriate Content</option>
          <option value="fake_profile">Fake Profile</option>
          <option value="other">Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="reportDescription">Additional details (optional):</label>
        <textarea id="reportDescription" name="description" rows="4" placeholder="Provide more details about the issue..."></textarea>
      </div>
      
      <div class="form-buttons">
        <button type="button" id="cancelReport" class="btn-cancel">Cancel</button>
        <button type="submit" class="btn-submit">Submit Report</button>
      </div>
    </form>
  </div>
</div>

>

{% endblock %}
