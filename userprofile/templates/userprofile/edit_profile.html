{% extends 'base.html' %}

{% block left_sidebar %}
{% endblock %}

{% block right_sidebar %}
{% endblock %}

{% block content %}





{% load static %}
<link rel="stylesheet" href="{% static 'userprofile/css/profile.css' %}">
<link rel="stylesheet" href="{% static 'userprofile/css/edit_profile.css' %}">

<!-- Edit Your Profile Modal -->
<div id="profile-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('profile-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üë§</div>
      <h2 class="modal-title">Edit Your Profile</h2>
      <p class="modal-subtitle">Update your personal information</p>
    </div>
    <div class="modal-body">
      <div class="edit-profile-form">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-row">
          <label for="{{ profile_form.profile_picture.id_for_label }}">Profile Picture:</label><br>
          <div id="profile-picture-preview" style="margin-bottom:8px;">
            {% if user.profile_picture %}
              <img id="profile-picture-img" src="{{ user.profile_picture.url }}" alt="Current profile picture" style="max-width:120px;max-height:120px;border-radius:50%;border:1px solid #ccc;display:block;">
            {% else %}
              <img id="profile-picture-img" src="" alt="Profile picture preview" style="max-width:120px;max-height:120px;border-radius:50%;border:1px solid #ccc;display:none;">
            {% endif %}
          </div>          <input type="file" name="profile_picture" id="{{ profile_form.profile_picture.id_for_label }}" accept="image/*">
        </div>
        <div class="form-row">
          <label for="first_name">First Name:</label>
          <input type="text" value="{{ user.first_name }}" disabled>
        </div>
        <div class="form-row">
          <label for="last_name">Last Name:</label>
          <input type="text" value="{{ user.last_name }}" disabled>
        </div>
        <div class="form-row">
          <label for="{{ profile_form.email.id_for_label }}">Email:</label><br>
          {{ profile_form.email }}
          <span class="inline-checkbox">{{ profile_form.show_email.label_tag }} {{ profile_form.show_email }}</span>
        </div>
        {% if profile_form.age_display %}
        <div class="form-row">
          {{ profile_form.age_display.label_tag }}
          {{ profile_form.age_display }}
          <span class="inline-checkbox">{{ profile_form.show_date_of_birth.label_tag }} {{ profile_form.show_date_of_birth }}</span>
        </div>
        {% endif %}
        {% if profile_form.gender_display %}
        <div class="form-row">
          {{ profile_form.gender_display.label_tag }}
          {{ profile_form.gender_display }}
          <span class="inline-checkbox">{{ profile_form.show_gender.label_tag }} {{ profile_form.show_gender }}</span>
        </div>
        {% endif %}
        {% if profile_form.show_pronouns_field %}
        <div class="form-row">
          {{ profile_form.pronouns.label_tag }}
          {{ profile_form.pronouns }}
          <span class="inline-checkbox">{{ profile_form.show_pronouns.label_tag }} {{ profile_form.show_pronouns }}</span>
        </div>
        {% endif %}
        <div class="form-row">
          <label for="{{ profile_form.phone_number.id_for_label }}">Phone Number:</label><br>
          {{ profile_form.phone_number }}
          <span class="inline-checkbox">{{ profile_form.show_phone_number.label_tag }} {{ profile_form.show_phone_number }}</span>
        </div>
        <div class="form-row">
          <label for="{{ profile_form.main_language.id_for_label }}">Main Language:</label><br>
          {{ profile_form.main_language }}
          <span class="flag-icon">{{ user.main_language_flag }}</span>
          <span class="inline-checkbox">{{ profile_form.show_main_language.label_tag }} {{ profile_form.show_main_language }}</span>
        </div>
        <div class="form-row">
          <label for="{{ profile_form.sublanguage.id_for_label }}">Sublanguage:</label><br>
          {{ profile_form.sublanguage }}
          <span class="flag-icon">{{ user.sublanguage_flag }}</span>
          <span class="inline-checkbox">{{ profile_form.show_sublanguage.label_tag }} {{ profile_form.show_sublanguage }}</span>
        </div>
        <div class="form-row">
          <label for="{{ profile_form.bio.id_for_label }}">About Me:</label><br>          {{ profile_form.bio }}
          <span class="inline-checkbox">{{ profile_form.show_bio.label_tag }} {{ profile_form.show_bio }}</span>
        </div>
        <div class="form-row form-row-submit">
          <button type="submit" name="save_profile">Save Changes <i class="fas fa-check"></i></button>
        </div>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- Places Modal -->
<div id="places-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('places-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üó∫Ô∏è</div>
      <h2 class="modal-title">Places I've Visited</h2>
      <p class="modal-subtitle">Add amazing places you've explored</p>
    </div>
    <div class="modal-body">
      <div class="edit-profile-form places-section">
      <h2>Places I‚Äôve Visited</h2>
      <form method="post" enctype="multipart/form-data" class="add-place-form">
        {% csrf_token %}
        {{ place_form.as_p }}
        <div class="form-row form-row-submit">
          <button type="submit" name="add_place">Add Place</button>
        </div>
      </form>
      {% if user.visited_places.all %}
        <h3>Your Added Places</h3>
        <div class="places-grid">
          {% for place in user.visited_places.all %}
            <div class="place-card">              <img src="{{ place.image.url }}" alt="{{ place.name }}" class="edit-place-preview">
              <p class="place-name">{{ place.name }}</p>
              <a href="{% url 'delete_place' place.id %}" class="delete-place"><i class="fas fa-trash"></i></a>
            </div>
          {% endfor %}
        </div>
      {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Achievements Modal -->
<div id="achievements-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('achievements-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üèÜ</div>
      <h2 class="modal-title">My Achievements</h2>
      <p class="modal-subtitle">Showcase your accomplishments</p>
    </div>
    <div class="modal-body">
      <div class="edit-profile-form achievements-section">
      <h3><i class="fas fa-trophy"></i> My Achievements</h3>
      <form method="post" enctype="multipart/form-data" class="add-achievement-form">
        {% csrf_token %}
        {{ achievement_form.as_p }}
        <div class="form-row form-row-submit">
          <button type="submit" name="add_achievement">Add Achievement</button>
        </div>
      </form>
      <div class="achievements-list">
        {% for a in user_achievements %}
          <div class="achievement-entry" style="display:flex;align-items:center;gap:10px;">
            {% if a.icon %}
              <img src="{{ a.icon.url }}" width="30">
            {% endif %}
            <span>{{ a.title }}</span>
            <form method="post" action="{% url 'delete_achievement' a.id %}" style="display:inline;margin-left:8px;">
              {% csrf_token %}
              <button type="submit" title="Delete Achievement" style="background:none;border:none;color:#d9534f;font-size:1.2em;cursor:pointer;"><i class="fas fa-trash"></i></button>
            </form>
          </div>
        {% endfor %}
      </div>
      </div>
    </div>
  </div>
</div>

<!-- Quotes Modal -->
<div id="quotes-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('quotes-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üí¨</div>
      <h2 class="modal-title">Quotes I Live By</h2>
      <p class="modal-subtitle">Share your favorite inspirational quotes</p>
    </div>
    <div class="modal-body">
      <div class="edit-profile-form quotes-section">
      <h3>üí¨ Quotes I Live By</h3>
      <form method="post" class="add-quote-form">
        {% csrf_token %}
        {{ quote_form.as_p }}
        <div class="form-row form-row-submit">
          <button type="submit" name="add_quote">Add Quote</button>
        </div>
      </form>
      <div class="quotes-list">
        {% for q in user_quotes %}
          <div class="quote-entry" style="display:flex;align-items:center;gap:10px;background:#c8f0fa;margin-bottom:12px;padding:12px 0 12px 12px;border-radius:8px;">
            <blockquote style="margin:0;font-style:italic;">{{ q.text }}</blockquote>
            <form method="post" action="{% url 'delete_quote' q.id %}" style="display:inline;margin-left:8px;">
              {% csrf_token %}
              <button type="submit" title="Delete Quote" style="background:none;border:none;color:#d9534f;font-size:1.2em;cursor:pointer;">üóëÔ∏è</button>
            </form>
          </div>
        {% endfor %}
      </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Content Modal -->
<div id="add-content-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('add-content-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üì∏</div>
      <h2 class="modal-title">Add Content Item</h2>
      <p class="modal-subtitle">Share photos, videos, or other content</p>
    </div>
    <div class="modal-body">
      <div class="edit-profile-form add-content-section">      <h2>Add Content Item</h2>
      <form method="post" enctype="multipart/form-data" class="add-content-form">
        {% csrf_token %}
        {{ content_form.as_p }}
        <div class="form-row form-row-submit">
          <button type="submit" name="add_content">Add Content</button>
        </div>
      </form>
      </div>
    </div>
  </div>
</div>

<!-- New "Update Your Interests" Modal (cleaned up version) -->
<div id="update-user-interests-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('update-user-interests-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üéØ</div>
      <h2 class="modal-title">Update Your Interests</h2>
      <p class="modal-subtitle">Choose up to 3 things you're passionate about</p>
    </div>
    <div class="modal-body">
      <!-- Hidden data for JavaScript -->
      <script id="user-interests-data" type="application/json">{{ user_interests_list_json|safe }}</script>
      <script id="wordlist-data" type="application/json">{{ wordlist_json|safe }}</script>    <div class="interest-section">
      <div id="user-interest-display">
        <p>Your current interests:</p>
        <ul class="interests-list" id="current-interests-list-profile">
          {% if user.interests %}
            {% for interest in user.interests %}
              <li>{{ interest }}</li>
            {% endfor %}
          {% else %}
            <li>No interests set yet.</li>
          {% endif %}
        </ul>
        <button type="button" id="edit-profile-interests-btn" onclick="showUserProfileInterestForm()">‚úèÔ∏è Edit Interests</button>
      </div>

      <form id="update-user-interests-form" method="POST" action="{% url 'edit_profile' %}" novalidate style="display:none;" onsubmit="return false;">
        {% csrf_token %}
        <input type="hidden" name="update-interest" value="1">
        <p>Select up to 3 interests:</p>
        <label for="id_interest_1">Interest 1:</label>
        <div class="autocomplete-container">
            <input type="text" name="interest_1" id="id_interest_1" list="profile-interest-suggestions-1" class="interest-input-profile" maxlength="50" autocomplete="off">
            <datalist id="profile-interest-suggestions-1"></datalist>
        </div>

        <label for="id_interest_2">Interest 2:</label>
        <div class="autocomplete-container">
            <input type="text" name="interest_2" id="id_interest_2" list="profile-interest-suggestions-2" class="interest-input-profile" maxlength="50" autocomplete="off">
            <datalist id="profile-interest-suggestions-2"></datalist>
        </div>

        <label for="id_interest_3">Interest 3:</label>
        <div class="autocomplete-container">
            <input type="text" name="interest_3" id="id_interest_3" list="profile-interest-suggestions-3" class="interest-input-profile" maxlength="50" autocomplete="off">
            <datalist id="profile-interest-suggestions-3"></datalist>
        </div>
        
        <button type="button" onclick="submitInterestForm()">üíæ Save Interests</button>
        <button type="button" onclick="hideUserProfileInterestForm()" class="cancel-btn">‚ùå Cancel</button>
      </form>
    </div>
    </div>
  </div>
</div>
<!-- END "Update Your Interests" Modal -->

<!-- Manage My Content Modal -->
<div id="manage-content-modal" class="modal">
  <div class="modal-content">
    <span class="close-modal" onclick="closeModal('manage-content-modal')">&times;</span>
    <div class="modal-header">
      <div class="modal-icon">üìÅ</div>
      <h2 class="modal-title">Manage My Content</h2>
      <p class="modal-subtitle">Organize and delete your content</p>    </div>
    <div class="modal-body">
      <div class="edit-profile-form manage-content-section">
        <div class="content-items-list">
          {% if user.content_items.all %}
            {% for item in user.content_items.all %}
              <div class="content-item-entry" style="display:flex;align-items:center;gap:10px;background:#f0f8ff;margin-bottom:12px;padding:12px 0 12px 12px;border-radius:8px;">
                {% if item.image %}
                  <img src="{{ item.image.url }}" alt="{{ item.title }}" style="width:40px;height:40px;object-fit:cover;border-radius:6px;">
                {% endif %}
                <div style="flex:1;">
                  <strong>{{ item.title|default:"Untitled" }}</strong>
                  {% if item.description %}<div style="font-size:0.95em;color:#555;">{{ item.description|truncatechars:50 }}</div>{% endif %}
                  {% if item.youtube_url %}<div style="font-size:0.9em;color:#0077cc;">YouTube: <a href="{{ item.youtube_url }}" target="_blank">{{ item.youtube_url|truncatechars:30 }}</a></div>{% endif %}
                </div>
                <form method="post" action="{% url 'delete_content' item.id %}" style="display:inline;margin-left:8px;">
                  {% csrf_token %}
                  <button type="submit" title="Delete Content" style="background:none;border:none;color:#d9534f;font-size:1.2em;cursor:pointer;">üóëÔ∏è</button>
                </form>
              </div>
            {% endfor %}
          {% else %}
            <div style="color:#888;text-align:center;padding:20px;">No content items yet. Start by adding some content!</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="profile-options-content-box">
    <span class="profile-options-close-btn" onclick="try { var m = window.parent.document.getElementById('editProfileModal'); if (m) m.style.display = 'none'; else { console.log('Attempted to close editProfileModal, but it was not found in parent.'); } } catch(e) { console.error('Error closing parent modal:', e); }">&times;</span>

    <div class="options-buttons-list">
      <button class="option-button" onclick="openModal('profile-modal')">Edit Your Profile</button>
      <button class="option-button" onclick="openModal('update-user-interests-modal')">Update Your Interests</button>
      <button class="option-button" onclick="openModal('places-modal')">Places I've Visited</button>
      <button class="option-button" onclick="openModal('achievements-modal')">My Achievements</button>
      <button class="option-button" onclick="openModal('quotes-modal')">Quotes I Live By</button>
      <button class="option-button" onclick="openModal('add-content-modal')">Add Content Item</button>
      <button class="option-button" onclick="openModal('manage-content-modal')">Manage My Content</button>
      <!-- <button class="option-button" onclick="openModal('uploaded-content-modal')">Your Uploaded Content</button> -->
    </div>
    <div class="save-button-container">
      <button type="button" class="option-button option-button-save" onclick="saveAllProfileForms();">Save All Changes ‚úÖ</button>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{% static 'userprofile/js/interests.js' %}"></script>
<script src="{% static 'userprofile/js/edit_profile.js' %}"></script>
{% endblock %}
